/*>>> FAXMACHINE <<<*/

var application_base64 = "PGh0bWw+CiAgPGhlYWQ+CiAgICA8c3R5bGU+CiAgICAgIC5oZWFkYnV0IHsKICAgICAgICBiYWNrZ3JvdW5kLWNvbG9yOiAjQ0NDOwogICAgICAgIG91dGxpbmU6IG5vbmU7CiAgICAgICAgdGV4dC1kZWNvcmF0aW9uOiBub25lOwogICAgICAgIGZvbnQtc2l6ZTogODsKICAgICAgICBwYWRkaW5nOiA1cHg7CiAgICAgICAgaGVpZ2h0OiAxNnB4OwogICAgICAgIG1hcmdpbi1sZWZ0OiAwOwogICAgICB9CiAgICAgIAogICAgICAuaGVhZGJ1dDpob3ZlciB7IGJhY2tncm91bmQtY29sb3I6ICMwNEY7IGNvbG9yOiBGRkYgfQogICAgPC9zdHlsZT4KICAgIDxsaW5rIHJlbD0ic3R5bGVzaGVldCIgaHJlZj0iaHR0cDovL3dpbmRvd3M5My5uZXQvYy9zeXMvc2tpbnMvdzkzLmNzcz92PTIuMy44Ij4KICA8L2hlYWQ+CiAgPGJvZHkgc3R5bGU9Im1hcmdpbjogMDsgZm9udC1zaXplOiAxMnB4OyI+CiAgICA8ZGl2IHN0eWxlPSJ3aWR0aDogNDg0cHg7IGhlaWdodDogNjQwcHg7IGJhY2tncm91bmQtY29sb3I6ICNBQUFBQUE7IG1hcmdpbjogMDsgcGFkZGluZzogLTVweCI+CiAgICAgIDxkaXYgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNDQ0NDQ0M7IGhlaWdodDogMjBweDsiPgogICAgICAgIDxzcGFuIGlkPSJzYXZlIiBjbGFzcz0iaGVhZGJ1dCI+U0FWRTwvc3Bhbj4KICAgICAgICA8c3BhbiBpZD0ib3BlbiIgY2xhc3M9ImhlYWRidXQiPk9QRU48L3NwYW4+CiAgICAgICAgPHNwYW4gaWQ9ImhlbHAiIGNsYXNzPSJoZWFkYnV0Ij5IRUxQPC9zcGFuPgogICAgICAgIDxzcGFuIHN0eWxlPSJjb2xvcjogZ3JheSI+JiMxNjA7JiMxNjA7JiMxNjA7PC9zcGFuPgogICAgICAgIDxzcGFuIGlkPSJwbGFpbiIgY2xhc3M9ImhlYWRidXQiPlBMQUlOPC9zcGFuPgogICAgICAgIDxzcGFuIGlkPSJ2b2lkIiBjbGFzcz0iaGVhZGJ1dCI+VEhFIFZPSUQ8L3NwYW4+CiAgICAgICAgPHNwYW4gaWQ9ImNvbG9yIiBjbGFzcz0iaGVhZGJ1dCI+Q09MT1IgSEFDS0VSPC9zcGFuPgogICAgICA8L2Rpdj4KICAgICAgPGNhbnZhcyB3aWR0aD0iNDgwIiBoZWlnaHQ9IjQ4MCIgc3R5bGU9IndpZHRoOiA0ODBweDsgaGVpZ2h0OiA0ODBweDsgYm9yZGVyOiAycHggaW5zZXQ7IiBpZD0idm94ZWxzY3JlZW4iPjwvY2FudmFzPgogICAgICA8ZGl2IHN0eWxlPSJvdmVyZmxvdy15OiBhdXRvOyB3aWR0aDogNDgwcHg7IGhlaWdodDogMTI1cHg7IG1hcmdpbi10b3A6IDJweDsgbWFyZ2luLWxlZnQ6IDRweCI+CiAgICAgICAgPGRpdj4KICAgICAgICAgIDxzcGFuPiBESVNUOiA8L3NwYW4+IDxpbnB1dCB0eXBlPSJyYW5nZSIgbWF4PSI2IiB2YWx1ZT0iMiIgc3RlcD0iMC4xIiBpZD0iZGlzdCIgc3R5bGU9IndpZHRoOiAzNjBweDsgcG9zaXRpb246IGFic29sdXRlOyBsZWZ0OiAxMDBweDsiPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXY+CiAgICAgICAgICA8c3Bhbj4gWS1QT1M6IDwvc3Bhbj4gPGlucHV0IHR5cGU9InJhbmdlIiBtYXg9IjE2IiB2YWx1ZT0iMCIgaWQ9Inlwb3MiIHN0eWxlPSJ3aWR0aDogMzYwcHg7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgbGVmdDogMTAwcHg7Ij4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2PgogICAgICAgICAgPHNwYW4+IE1PVVNFOiA8L3NwYW4+IDxpbnB1dCB0eXBlPSJyYW5nZSIgbWF4PSIzMCIgdmFsdWU9IjEwIiBpZD0ibW91c2UiIHN0eWxlPSJ3aWR0aDogMzYwcHg7IHBvc2l0aW9uOiBhYnNvbHV0ZTsgbGVmdDogMTAwcHg7Ij4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2PjwvZGl2PgogICAgICAgIDxocj48Y2VudGVyPgogICAgICAgIAk8YnV0dG9uIG9uY2xpY2s9InRpbGVfY29sb3IzZD1nZXRDb2xvcignIzAwMDAwMCcpIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogIzAwMDAwMCI+JiMxNjA7JiMxNjA7JiMxNjA7JiMxNjA7PC9idXR0b24+CiAgICAgICAgCTxidXR0b24gb25jbGljaz0idGlsZV9jb2xvcjNkPWdldENvbG9yKCcjMDAwMEZGJykiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiAjMDAwMEZGIj4mIzE2MDsmIzE2MDsmIzE2MDsmIzE2MDs8L2J1dHRvbj4KICAgICAgICAJPGJ1dHRvbiBvbmNsaWNrPSJ0aWxlX2NvbG9yM2Q9Z2V0Q29sb3IoJyMwMEZGMDAnKSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICMwMEZGMDAiPiYjMTYwOyYjMTYwOyYjMTYwOyYjMTYwOzwvYnV0dG9uPgogICAgICAgIAk8YnV0dG9uIG9uY2xpY2s9InRpbGVfY29sb3IzZD1nZXRDb2xvcignIzAwRkZGRicpIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogIzAwRkZGRiI+JiMxNjA7JiMxNjA7JiMxNjA7JiMxNjA7PC9idXR0b24+CiAgICAgICAgCTxidXR0b24gb25jbGljaz0idGlsZV9jb2xvcjNkPWdldENvbG9yKCcjRkYwMDAwJykiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiAjRkYwMDAwIj4mIzE2MDsmIzE2MDsmIzE2MDsmIzE2MDs8L2J1dHRvbj4KICAgICAgICAJPGJ1dHRvbiBvbmNsaWNrPSJ0aWxlX2NvbG9yM2Q9Z2V0Q29sb3IoJyNGRjAwRkYnKSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNGRjAwRkYiPiYjMTYwOyYjMTYwOyYjMTYwOyYjMTYwOzwvYnV0dG9uPgogICAgICAgIAk8YnV0dG9uIG9uY2xpY2s9InRpbGVfY29sb3IzZD1nZXRDb2xvcignI0ZGRkYwMCcpIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogI0ZGRkYwMCI+JiMxNjA7JiMxNjA7JiMxNjA7JiMxNjA7PC9idXR0b24+CiAgICAgICAgCTxidXR0b24gb25jbGljaz0idGlsZV9jb2xvcjNkPWdldENvbG9yKCcjRkZGRkZGJykiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiAjRkZGRkZGIj4mIzE2MDsmIzE2MDsmIzE2MDsmIzE2MDs8L2J1dHRvbj4KICAgICAgICAJPGJ1dHRvbiBvbmNsaWNrPSJ0aWxlX2NvbG9yM2Q9Z2V0Q29sb3IoJyMwMDAwODgnKSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICMwMDAwODgiPiYjMTYwOyYjMTYwOyYjMTYwOyYjMTYwOzwvYnV0dG9uPgogICAgICAgIAk8YnV0dG9uIG9uY2xpY2s9InRpbGVfY29sb3IzZD1nZXRDb2xvcignIzAwODgwMCcpIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogIzAwODgwMCI+JiMxNjA7JiMxNjA7JiMxNjA7JiMxNjA7PC9idXR0b24+CiAgICAgICAgCTxidXR0b24gb25jbGljaz0idGlsZV9jb2xvcjNkPWdldENvbG9yKCcjMDA4ODg4JykiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiAjMDA4ODg4Ij4mIzE2MDsmIzE2MDsmIzE2MDsmIzE2MDs8L2J1dHRvbj4KICAgICAgICAJPGJ1dHRvbiBvbmNsaWNrPSJ0aWxlX2NvbG9yM2Q9Z2V0Q29sb3IoJyM4ODAwMDAnKSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICM4ODAwMDAiPiYjMTYwOyYjMTYwOyYjMTYwOyYjMTYwOzwvYnV0dG9uPgogICAgICAgIAk8YnV0dG9uIG9uY2xpY2s9InRpbGVfY29sb3IzZD1nZXRDb2xvcignIzg4MDA4OCcpIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjogIzg4MDA4OCI+JiMxNjA7JiMxNjA7JiMxNjA7JiMxNjA7PC9idXR0b24+CiAgICAgICAgCTxidXR0b24gb25jbGljaz0idGlsZV9jb2xvcjNkPWdldENvbG9yKCcjODg4ODAwJykiIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiAjODg4ODAwIj4mIzE2MDsmIzE2MDsmIzE2MDsmIzE2MDs8L2J1dHRvbj4KICAgICAgICAJPGJ1dHRvbiBvbmNsaWNrPSJ0aWxlX2NvbG9yM2Q9Z2V0Q29sb3IoJyM4ODg4ODgnKSIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICM4ODg4ODgiPiYjMTYwOyYjMTYwOyYjMTYwOyYjMTYwOzwvYnV0dG9uPgogICAgICAgIDwvY2VudGVyPjxocj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICAgIDxzY3JpcHQgbmFtZT0iZW5naW5lIj4KICAgICAgLyogPj4+IEYgQSBYIE0gQSBDIEggSSBOIEUgPDw8ICovCgogICAgICBjb25zdCBXSURUSCA9IDQ4MCwgSEVJR0hUID0gNDgwOwoKICAgICAgdmFyIGNhbnZhcyA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2b3hlbHNjcmVlbicpOwogICAgICB2YXIgb2ZzY3IgPSAgZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnY2FudmFzJyk7CiAgICAgIHZhciBjdHggPSBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKTsKICAgICAgdmFyIG9mYyA9IG9mc2NyLmdldENvbnRleHQoJzJkJyk7CgogICAgICBjdHguaW1hZ2VTbW9vdGhpbmdFbmFibGVkID0gZmFsc2U7CiAgICAgIC8vY3R4LnNjYWxlKDIsIDIpOwoKICAgICAgb2ZzY3Iud2lkdGggPSBXSURUSDsKICAgICAgb2ZzY3IuaGVpZ2h0ID0gSEVJR0hUOwoKICAgICAgLyogZnVuY3Rpb24gZm9yIGRyYXdpbmcgNC1zaWRlZCBwb2x5Z29ucyAqLwoKICAgICAgZnVuY3Rpb24gZHJhd3BvbHkocDEsIHAyLCBwNCwgcDMsIGNvbG9yKSB7CiAgICAgICAgb2ZjLmZpbGxTdHlsZSA9IGNvbG9yOwogICAgICAgIG9mYy5iZWdpblBhdGgoKTsKICAgICAgICBvZmMubW92ZVRvKHAxLngsIHAxLnkpOwogICAgICAgIG9mYy5saW5lVG8ocDMueCwgcDMueSk7CiAgICAgICAgb2ZjLmxpbmVUbyhwNC54LCBwNC55KTsKICAgICAgICBvZmMubGluZVRvKHAyLngsIHAyLnkpOwogICAgICAgIG9mYy5jbG9zZVBhdGgoKTsKICAgICAgICBvZmMuZmlsbCgpOwogICAgICAgIG9mYy5iZWdpblBhdGgoKTsKICAgICAgICBvZmMubW92ZVRvKHAxLngsIHAxLnkpOwogICAgICAgIG9mYy5saW5lVG8ocDMueCwgcDMueSk7CiAgICAgICAgb2ZjLm1vdmVUbyhwMy54LCBwMy55KTsKICAgICAgICBvZmMubGluZVRvKHA0LngsIHA0LnkpOwogICAgICAgIG9mYy5tb3ZlVG8ocDQueCwgcDQueSk7CiAgICAgICAgb2ZjLmxpbmVUbyhwMi54LCBwMi55KTsKICAgICAgICBvZmMubW92ZVRvKHAyLngsIHAyLnkpOwogICAgICAgIG9mYy5saW5lVG8ocDEueCwgcDEueSk7CiAgICAgICAgb2ZjLmNsb3NlUGF0aCgpOwogICAgICAgIG9mYy5zdHJva2UoKTsKICAgICAgfQoKICAgICAgY2xhc3MgUG9pbnQyRCB7CgogICAgICAgIGNvbnN0cnVjdG9yKHgsIHkpIHsKCiAgICAgICAgICB0aGlzLnggPSB4OwogICAgICAgICAgdGhpcy55ID0geTsKICAgICAgICB9CiAgICAgIH0KCiAgICAgIGNsYXNzIFBvaW50M0QgewoKICAgICAgICBjb25zdHJ1Y3Rvcih4LCB5LCB6KSB7CgogICAgICAgICAgdGhpcy54ID0geDsKICAgICAgICAgIHRoaXMueSA9IHk7CiAgICAgICAgICB0aGlzLnogPSB6OwogICAgICAgIH0KICAgICAgfQoKICAgICAgY2xhc3MgUGxhaW4gewoKICAgICAgICBjb25zdHJ1Y3RvcihwMSwgcDIsIHAzLCBwNCwgY29sb3IsIHBvczEsIHBvczIpIHsKCiAgICAgICAgICB0aGlzLnAgPSBbcDEsIHAyLCBwMywgcDRdOwoKICAgICAgICAgIHRoaXMuY29sb3IgPSBjb2xvcjsKCiAgICAgICAgICB0aGlzLnBvczEgPSBwb3MxOwoKICAgICAgICAgIHRoaXMucG9zMiAgPSBwb3MyOwogICAgICAgIH0KICAgICAgfQoKICAgICAgZnVuY3Rpb24gcm90YXRlKHgsIHksIGFuZ2xlKSB7CgogICAgICAgIHJldHVybiBbeCAqIGFuZ2xlLmNvcyAtIHkgKiBhbmdsZS5zaW4sIHggKiBhbmdsZS5zaW4gKyB5ICogYW5nbGUuY29zXTsKICAgICAgfQoKICAgICAgZnVuY3Rpb24gcm90YXRlM2QoeCwgeSwgeiwgbHIsIHVkKSB7CgogICAgICAgIFt4LCB6XSA9IHJvdGF0ZSh4LCB6LCBscik7CgogICAgICAgIFt5LCB6XSA9IHJvdGF0ZSh5LCB6LCB1ZCk7CgogICAgICAgIHJldHVybiBbeCwgeSwgel07CiAgICAgIH0KCiAgICAgIC8qCgogICAgICBuZXcgQ2FtZXJhKCA8TnVtYmVyID0gZmllbGQgb2Ygdmlldz4gKSByZXR1cm5zIENhbWVyYQoKICAgICAgQ2FtZXJhLnJvdGF0ZSggPE51bWJlciA9IGxlZnQtcmlnaHQgcm90YXRpb24+LCA8TnVtYmVyID0gdXAtZG93biByb3RhdGlvbj4gKSByZXR1cm5zIHZvaWQKCiAgICAgIENhbWVyYS5wcm9qZWN0KCA8UG9pbnQzRD4gKSByZXR1cm5zIFBvaW50MkQKCiAgICAgIENhbWVyYS5zZXRGb3YoIDxOdW1iZXIgPSBmaWVsZCBvZiB2aWV3PiApCgogICAgICAqLwoKICAgICAgY2xhc3MgQ2FtZXJhIHsKCiAgICAgICAgY29uc3RydWN0b3IoZm92LCBkaXN0KSB7CgogICAgICAgICAgdGhpcy5jc3ogPSAwLjYgLyA4OwogICAgICAgICAgdGhpcy50b3AgPSAwOwoKICAgICAgICAgIHRoaXMucm90TFIgPSB7dmFsOiAwLCBzaW46IDAsIGNvczogMX07CiAgICAgICAgICB0aGlzLnJvdFVEID0ge3ZhbDogMCwgc2luOiAwLCBjb3M6IDF9OwoKICAgICAgICAgIHRoaXMuZGlzdCA9IGRpc3Q7CiAgICAgICAgICB0aGlzLmZvdl9jdGcgPSAxIC8gTWF0aC50YW4oZm92ICogTWF0aC5QSSAvIDM2MCk7CiAgICAgICAgfQoKICAgICAgICByb3RhdGUoeHosIHl6KSB7CgogICAgICAgICAgdGhpcy5yb3RMUi52YWwgLT0geHo7CiAgICAgICAgICB0aGlzLnJvdFVELnZhbCAtPSB5ejsKCiAgICAgICAgICB0aGlzLnJvdExSLnNpbiA9IE1hdGguc2luKHRoaXMucm90TFIudmFsKTsKICAgICAgICAgIHRoaXMucm90TFIuY29zID0gTWF0aC5jb3ModGhpcy5yb3RMUi52YWwpOwogICAgICAgICAgdGhpcy5yb3RVRC5zaW4gPSBNYXRoLnNpbih0aGlzLnJvdFVELnZhbCk7CiAgICAgICAgICB0aGlzLnJvdFVELmNvcyA9IE1hdGguY29zKHRoaXMucm90VUQudmFsKTsKICAgICAgICB9CgogICAgICAgIHNldEZvdihmb3YpIHsKCiAgICAgICAgICB0aGlzLmZvdl9jdGcgPSAxIC8gTWF0aC50YW4oZm92ICogTWF0aC5QSSAvIDM2MCk7CiAgICAgICAgfQoKICAgICAgICBwcm9qZWN0KHAzZCkgewoKICAgICAgICAgIHZhciB4ID0gKHAzZC54IC0gOCkgKiB0aGlzLmNzejsKICAgICAgICAgIHZhciB5ID0gKHRoaXMudG9wIC0gcDNkLnkpICogdGhpcy5jc3o7CiAgICAgICAgICB2YXIgeiA9IChwM2QueiAtIDgpICogdGhpcy5jc3o7CgogICAgICAgICAgW3gsIHksIHpdID0gcm90YXRlM2QoeCwgeSwgeiwgdGhpcy5yb3RMUiwgdGhpcy5yb3RVRCk7CgogICAgICAgICAgeiArPSB0aGlzLmRpc3Q7CgogICAgICAgICAgdmFyIGQgPSB0aGlzLmZvdl9jdGcgLyB6OwoKICAgICAgICAgIHJldHVybiBuZXcgUG9pbnQyRChXSURUSCAqICgwLjUgKyB4ICogZCksIEhFSUdIVCAqICgwLjUgKyB5ICogZCkpOwogICAgICAgIH0KCiAgICAgICAgZ2V0RGlzdChwM2QpIHsKCiAgICAgICAgICB2YXIgeCA9IChwM2QueCAtIDgpICogdGhpcy5jc3o7CiAgICAgICAgICB2YXIgeSA9ICh0aGlzLnRvcCAtIHAzZC55KSAqIHRoaXMuY3N6OwogICAgICAgICAgdmFyIHogPSAocDNkLnogLSA4KSAqIHRoaXMuY3N6OwoKICAgICAgICAgIFt4LCB5LCB6XSA9IHJvdGF0ZTNkKHgsIHksIHosIHRoaXMucm90TFIsIHRoaXMucm90VUQpOwoKICAgICAgICAgIHogKz0gdGhpcy5kaXN0OwoKICAgICAgICAgIHJldHVybiB4ICogeCArIHkgKiB5ICsgeiAqIHo7CiAgICAgICAgfQogICAgICB9CiAgICA8L3NjcmlwdD4KICAgIDxzY3JpcHQgbmFtZT0ibWFpbiI+CiAgICAJLyogY29uc3RhbnRzICovCgogICAgICBjb25zdCBFTVBUWSA9ICgxIDw8IDE1KTsKCiAgICAgIC8qIGdldCBwb3NpdGlvbiBudW1iZXIgaW4gbWFwICovCgogICAgICBmdW5jdGlvbiBnZXRQb3MoeCwgeSwgeikgewoKICAgICAgICByZXR1cm4gKHggPDwgOCkgfCAoeSA8PCA0KSB8IHo7CiAgICAgIH0KCiAgICAgIC8qIGdldCBjb2xvciBudW1iZXIgKi8KCiAgICAgIGZ1bmN0aW9uIGdldENvbG9yKHMpIHsKCiAgICAgICAgcmV0dXJuIChOdW1iZXIoJzB4JyArIHMuc3Vic3RyKDEsIDIpKSA8PCAxNikgfCAoTnVtYmVyKCcweCcgKyBzLnN1YnN0cigzLCAyKSkgPDwgOCkgfCBOdW1iZXIoJzB4JyArIHMuc3Vic3RyKDUsIDIpKTsKICAgICAgfQoKICAgICAgLyogZ2V0IHNxdWFyZSBvZiBkaXN0YW5jZSBvZiBhIHNpZGUgb2Ygc3F1YXJlIGZyb20gY2FtZXJhICovCgogICAgICBmdW5jdGlvbiBkaXN0KGNhbSwgcGxpKSB7CgogICAgICAgIHZhciBtYSA9IDA7CgogICAgICAgIGZvcih2YXIgaSBpbiBwbGkucCkgewoKICAgICAgICAgIG1hID0gTWF0aC5tYXgobWEsIGNhbWVyYS5nZXREaXN0KHBsaS5wW2ldKSk7CiAgICAgICAgfQoKICAgICAgICByZXR1cm4gbWE7CiAgICAgIH0KCiAgICAgIC8qIGNoZWNrIGlmIHBvaW50IGlzIGluc2lkZSBhIHBvbHlnb24gKi8KCiAgICAgIGZ1bmN0aW9uIGluc2lkZShwb2ludCwgcG9seSkgewoKICAgICAgICAgIHZhciB4ID0gcG9pbnQueCwgeSA9IHBvaW50Lnk7CgogICAgICAgICAgdmFyIHZzID0gcG9seS5wOwoKICAgICAgICAgIHZhciBpbnNpZGUgPSBmYWxzZTsKICAgICAgICAgIGZvciAodmFyIGkgPSAwLCBqID0gdnMubGVuZ3RoIC0gMTsgaSA8IHZzLmxlbmd0aDsgaiA9IGkrKykgewogICAgICAgICAgICAgIHZhciB4aSA9IHZzW2ldLngsIHlpID0gdnNbaV0ueTsKICAgICAgICAgICAgICB2YXIgeGogPSB2c1tqXS54LCB5aiA9IHZzW2pdLnk7CgogICAgICAgICAgICAgIHZhciBpbnRlcnNlY3QgPSAoKHlpID4geSkgIT0gKHlqID4geSkpCiAgICAgICAgICAgICAgICAgICYmICh4IDwgKHhqIC0geGkpICogKHkgLSB5aSkgLyAoeWogLSB5aSkgKyB4aSk7CiAgICAgICAgICAgICAgaWYgKGludGVyc2VjdCkgaW5zaWRlID0gIWluc2lkZTsKICAgICAgICAgIH0KCiAgICAgICAgICByZXR1cm4gaW5zaWRlOwogICAgICB9OwoKICAgICAgdmFyIGNhbWVyYSA9IG5ldyBDYW1lcmEoOTAsIDIpOyAvLyBDYW1lcmEgb2JqZWN0CgogICAgICBjYW1lcmEucm90YXRlKC1NYXRoLlBJICogMC4yNSwgLU1hdGguUEkgKiAwLjI1KTsKCiAgICAgIC8qIG1hcCBmb3IgdGVzdGluZywgdGhpcyBwYXJ0IG9mIGNvZGUgd2lsbCBsYXRlciBiZSByZXBsYWNlZCAqLwoKICAgICAgdmFyIG1hcCA9IG5ldyBVaW50MzJBcnJheSg0MDk2KTsKCiAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCAzMjc2ODsgaSsrKSBtYXBbaV0gPSBFTVBUWTsKCiAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCAxNjsgaSsrKSBmb3IodmFyIGogPSAwOyBqIDwgMTY7IGorKykgbWFwW2dldFBvcyhpLCAwLCBqKV0gPSAyNTUgPDwgODsKCiAgICAgIC8qIHJlbmRlciAqLwoKICAgICAgdmFyIHBsYWluczNEID0gW10sIHByb2plY3Rpb25zID0gW107CgogICAgICAvKiBjaGVjayBpZiBwbGFjZSBpbiB0aGUgbWFwIGlzIGVtcHR5ICovCgogICAgICBmdW5jdGlvbiBpc0VtcHR5KHgsIHksIHopIHsKCiAgICAgICAgcmV0dXJuIHggPCAwIHx8IHkgPCAwIHx8IHogPCAwIHx8IHggPiAxNSB8fCB5ID4gMTUgfHwgeiA+IDE1IHx8IG1hcFtnZXRQb3MoeCwgeSwgeildID09IEVNUFRZOwogICAgICB9CgogICAgICAvKiBsZWZ0IHBhZCAqLwoKICAgICAgU3RyaW5nLnByb3RvdHlwZS5scGFkID0gZnVuY3Rpb24obiwgYykgewoKICAgICAgICBzID0gJyc7CgogICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBNYXRoLm1heChuIC0gdGhpcy5sZW5ndGgsIDApOyBpKyspIHsKCiAgICAgICAgICBzICs9ICcwJzsKICAgICAgICB9CgogICAgICAgIHJldHVybiBzICsgdGhpczsKICAgICAgfQoKICAgICAgLyogZnVuY3Rpb24gZm9yIGxvYWRpbmcgYSAzYm0gKGJpdG1hcCBmb3JtYXQgZm9yIDkzRCApICovCgogICAgICBmdW5jdGlvbiBsb2FkTWFwKG1hcCkgewoKICAgICAgICBwbGFpbnMzRCA9IFtdOwoKICAgICAgICBmb3IodmFyIHggPSAwOyB4IDwgMTY7IHgrKykgewogICAgICAgICAgZm9yKHZhciB5ID0gMDsgeSA8IDE2OyB5KyspIHsKICAgICAgICAgICAgZm9yKHZhciB6ID0gMDsgeiA8IDE2OyB6KyspIHsKICAgICAgICAgICAgICBpZihtYXBbZ2V0UG9zKHgsIHksIHopXSAhPSBFTVBUWSkgewoKICAgICAgICAgICAgICAgIHZhciBjb2xvciA9ICcjJyArICgobWFwW2dldFBvcyh4LCB5LCB6KV0gPj4gMTYpICYgMjU1KS50b1N0cmluZygxNikubHBhZCgyLCAnMCcpICsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICgobWFwW2dldFBvcyh4LCB5LCB6KV0gPj4gOCkgJiAyNTUpLnRvU3RyaW5nKDE2KS5scGFkKDIsICcwJykgKwogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgKG1hcFtnZXRQb3MoeCwgeSwgeildICYgMjU1KS50b1N0cmluZygxNikubHBhZCgyLCAnMCcpOwoKICAgICAgICAgICAgICAgIGlmKGlzRW1wdHkoeCArIDEsIHksIHopKSBwbGFpbnMzRC5wdXNoKG5ldyBQbGFpbigKCiAgICAgICAgICAgICAgICAgIG5ldyBQb2ludDNEKHggKyAxLCB5ICsgMSwgeiArIDEpLAogICAgICAgICAgICAgICAgICBuZXcgUG9pbnQzRCh4ICsgMSwgeSArIDEsIHopLAogICAgICAgICAgICAgICAgICBuZXcgUG9pbnQzRCh4ICsgMSwgeSwgeiksCiAgICAgICAgICAgICAgICAgIG5ldyBQb2ludDNEKHggKyAxLCB5LCB6ICsgMSksCgogICAgICAgICAgICAgICAgICBjb2xvciwgbmV3IFBvaW50M0QoeCwgeSwgeiksIG5ldyBQb2ludDNEKHggKyAxLCB5LCB6KQogICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgICAgICBpZihpc0VtcHR5KHgsIHkgLSAxLCB6KSkgcGxhaW5zM0QucHVzaChuZXcgUGxhaW4oCgogICAgICAgICAgICAgICAgICBuZXcgUG9pbnQzRCh4LCB5LCB6KSwKICAgICAgICAgICAgICAgICAgbmV3IFBvaW50M0QoeCwgeSwgeiArIDEpLAogICAgICAgICAgICAgICAgICBuZXcgUG9pbnQzRCh4ICsgMSwgeSwgeiArIDEpLAogICAgICAgICAgICAgICAgICBuZXcgUG9pbnQzRCh4ICsgMSwgeSwgeiksCgogICAgICAgICAgICAgICAgICBjb2xvciwgbmV3IFBvaW50M0QoeCwgeSwgeiksIG5ldyBQb2ludDNEKHgsIHkgLSAxLCB6KQogICAgICAgICAgICAgICAgKSk7CiAgICAgICAgICAgICAgICBpZihpc0VtcHR5KHgsIHksIHogKyAxKSkgcGxhaW5zM0QucHVzaChuZXcgUGxhaW4oCgogICAgICAgICAgICAgICAgICBuZXcgUG9pbnQzRCh4LCB5ICsgMSwgeiArIDEpLAogICAgICAgICAgICAgICAgICBuZXcgUG9pbnQzRCh4ICsgMSwgeSArIDEsIHogKyAxKSwKICAgICAgICAgICAgICAgICAgbmV3IFBvaW50M0QoeCArIDEsIHksIHogKyAxKSwKICAgICAgICAgICAgICAgICAgbmV3IFBvaW50M0QoeCwgeSwgeiArIDEpLAoKICAgICAgICAgICAgICAgICAgY29sb3IsIG5ldyBQb2ludDNEKHgsIHksIHopLCBuZXcgUG9pbnQzRCh4LCB5LCB6ICsgMSkKICAgICAgICAgICAgICAgICkpOwogICAgICAgICAgICAgICAgaWYoaXNFbXB0eSh4IC0gMSwgeSwgeikpIHBsYWluczNELnB1c2gobmV3IFBsYWluKAoKICAgICAgICAgICAgICAgICAgbmV3IFBvaW50M0QoeCwgeSwgeiksCiAgICAgICAgICAgICAgICAgIG5ldyBQb2ludDNEKHgsIHksIHogKyAxKSwKICAgICAgICAgICAgICAgICAgbmV3IFBvaW50M0QoeCwgeSArIDEsIHogKyAxKSwKICAgICAgICAgICAgICAgICAgbmV3IFBvaW50M0QoeCwgeSArIDEsIHopLAoKICAgICAgICAgICAgICAgICAgY29sb3IsIG5ldyBQb2ludDNEKHgsIHksIHopLCBuZXcgUG9pbnQzRCh4IC0gMSwgeSwgeikKICAgICAgICAgICAgICAgICkpOwogICAgICAgICAgICAgICAgaWYoaXNFbXB0eSh4LCB5ICsgMSwgeikpIHBsYWluczNELnB1c2gobmV3IFBsYWluKAoKICAgICAgICAgICAgICAgICAgbmV3IFBvaW50M0QoeCwgeSArIDEsIHopLAogICAgICAgICAgICAgICAgICBuZXcgUG9pbnQzRCh4ICsgMSwgeSArIDEsIHopLAogICAgICAgICAgICAgICAgICBuZXcgUG9pbnQzRCh4ICsgMSwgeSArIDEsIHogKyAxKSwKICAgICAgICAgICAgICAgICAgbmV3IFBvaW50M0QoeCwgeSArIDEsIHogKyAxKSwKCiAgICAgICAgICAgICAgICAgIGNvbG9yLCBuZXcgUG9pbnQzRCh4LCB5LCB6KSwgbmV3IFBvaW50M0QoeCwgeSArIDEsIHopCiAgICAgICAgICAgICAgICApKTsKICAgICAgICAgICAgICAgIGlmKGlzRW1wdHkoeCwgeSwgeiAtIDEpKSBwbGFpbnMzRC5wdXNoKG5ldyBQbGFpbigKCiAgICAgICAgICAgICAgICAgIG5ldyBQb2ludDNEKHgsIHksIHopLAogICAgICAgICAgICAgICAgICBuZXcgUG9pbnQzRCh4ICsgMSwgeSwgeiksCiAgICAgICAgICAgICAgICAgIG5ldyBQb2ludDNEKHggKyAxLCB5ICsgMSwgeiksCiAgICAgICAgICAgICAgICAgIG5ldyBQb2ludDNEKHgsIHkgKyAxLCB6KSwKCiAgICAgICAgICAgICAgICAgIGNvbG9yLCBuZXcgUG9pbnQzRCh4LCB5LCB6KSwgbmV3IFBvaW50M0QoeCwgeSwgeiAtIDEpCiAgICAgICAgICAgICAgICApKTsKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0KICAgICAgICAgIH0KICAgICAgICB9CiAgICAgIH0KCiAgICAgIC8qIE1PVVNFIFNFTlNJVElWSVRZICovCiAgICAgIAogICAgICB2YXIgTU9VU0VfU0VOU0lUSVZJVFkgPSAxMDsKICAgICAgCiAgICAgIC8qIC0tLS0tLS0tLS0tLS0tLS0gKi8KICAgICAgCiAgICAgIAogICAgICAvKiBKb2huOiBJIGdvdCBsb3N0IGluIGhlcmUuICovCiAgICAgIAogICAgICBjdHguZmlsbFN0eWxlID0gJyMxOTE5NzAnOwoKICAgICAgLyogZnVuY3Rpb24gZm9yIHJlbmRlcmluZyBzY3JlZW4gKi8KCiAgICAgIGZ1bmN0aW9uIHJlbmRlcigpIHsKCiAgICAgICAgcHJvamVjdGlvbnMgPSBbXTsKCiAgICAgICAgY3R4LmNsZWFyUmVjdCgwLCAwLCBXSURUSCwgSEVJR0hUKTsKICAgICAgICBvZmMuY2xlYXJSZWN0KDAsIDAsIFdJRFRILCBIRUlHSFQpOwoKICAgICAgICBwbGFpbnMzRC5zb3J0KChhLCBiKSA9PiBkaXN0KGNhbWVyYSwgYikgLSBkaXN0KGNhbWVyYSwgYSkpOwoKICAgICAgICBmb3IodmFyIGkgPSAwOyBpIDwgcGxhaW5zM0QubGVuZ3RoOyBpKyspIHsKCiAgICAgICAgICBkcmF3cG9seSguLi5wbGFpbnMzRFtpXS5wLm1hcCh4ID0+IGNhbWVyYS5wcm9qZWN0KHgpKSwgcGxhaW5zM0RbaV0uY29sb3IpOwoKICAgICAgICAgIHByb2plY3Rpb25zLnB1c2gobmV3IFBsYWluKC4uLnBsYWluczNEW2ldLnAubWFwKHggPT4gY2FtZXJhLnByb2plY3QoeCkpLCBkaXN0KGNhbWVyYSwgcGxhaW5zM0RbaV0pLCBwbGFpbnMzRFtpXS5wb3MxLCBwbGFpbnMzRFtpXS5wb3MyKSk7CiAgICAgICAgfQoKICAgICAgICBjdHguZmlsbFJlY3QoMCwgMCwgV0lEVEgsIEhFSUdIVCk7CgogICAgICAgIGN0eC5kcmF3SW1hZ2Uob2ZzY3IsIDAsIDApOwogICAgICB9CgogICAgICB2YXIgdGlsZV9jb2xvcjNkID0gMjU1OyAvLyBjb2xvciBvZiB0aWxlcyB0byBiZSBwbGFjZWQKCiAgICAgIHZhciBrZXkgPSB7fTsKICAgICAgdmFyIG1vdXNlID0ge2xlZnQ6IGZhbHNlLCByaWdodDogZmFsc2UsIHg6IDAsIHk6IDAsIGNvdW50OiAwfTsKCiAgICAgIHZhciB1cGRhdGUzREIgPSBmdW5jdGlvbigpIHsKCiAgICAgICAgLyogcm90YXRpb24gc3R1ZmYgKi8KCiAgICAgICAgaWYoa2V5Wzg3XSkgY2FtZXJhLnJvdGF0ZSgwLCAtTWF0aC5QSSAvIDkwKTsKICAgICAgICBpZihrZXlbODNdKSBjYW1lcmEucm90YXRlKDAsIE1hdGguUEkgLyA5MCk7CiAgICAgICAgaWYoa2V5WzY4XSkgY2FtZXJhLnJvdGF0ZSgtTWF0aC5QSSAvIDkwLCAwKTsKICAgICAgICBpZihrZXlbNjVdKSBjYW1lcmEucm90YXRlKE1hdGguUEkgLyA5MCwgMCk7CgogICAgICAgIC8qIG1vdXNlIHN0dWZmICovCgogICAgICAgIGlmKChtb3VzZS5sZWZ0IHx8IG1vdXNlLnJpZ2h0KSAmJiAhbW91c2UuY291bnQpIHsKCiAgICAgICAgICB2YXIgcG9zMSA9IC0xLCBwb3MyID0gLTEsIGRpID0gMWU5OyAvLyBwb3MxID0gcG9zaXRpb24gb2YgY3VycmVudCBibG9jaywgcG9zMiA9IHBvc2l0aW9uIG9mIGJsb2NrIHRoaXMgc2lkZSBpcyBmYWNpbmcgdG93YXJkcwoKICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCBwcm9qZWN0aW9ucy5sZW5ndGg7IGkrKykgewoKICAgICAgICAgICAgaWYoaW5zaWRlKG1vdXNlLCBwcm9qZWN0aW9uc1tpXSkgJiYgcHJvamVjdGlvbnNbaV0uY29sb3IgPCBkaSkgewoKICAgICAgICAgICAgICBkaSA9IHByb2plY3Rpb25zW2ldLmNvbG9yOyAvLyBjb2xvciBhY3RzIGFzIGRpc3RhbmNlIGhlcmUgKGRvbid0IGFzayB3aHksIHRoZXJlJ3Mgbm8gZ29vZCBhbnN3ZXIpCgogICAgICAgICAgICAgIHBvczEgPSBwcm9qZWN0aW9uc1tpXS5wb3MxOwogICAgICAgICAgICAgIHBvczIgPSBwcm9qZWN0aW9uc1tpXS5wb3MyOwogICAgICAgICAgICB9CiAgICAgICAgICB9CgogICAgICAgICAgaWYocG9zMSAhPSAtMSkgewoKICAgICAgICAgICAgaWYobW91c2UubGVmdCkgbWFwW2dldFBvcyhwb3MyLngsIHBvczIueSwgcG9zMi56KV0gPSB0aWxlX2NvbG9yM2Q7CiAgICAgICAgICAgIGlmKG1vdXNlLnJpZ2h0KSBtYXBbZ2V0UG9zKHBvczEueCwgcG9zMS55LCBwb3MxLnopXSA9IEVNUFRZOwoKICAgICAgICAgICAgbW91c2UuY291bnQgPSBNT1VTRV9TRU5TSVRJVklUWTsgLy8gbW91c2UgY291bnQgcHJldmVudHMgdW5pbnRlbnRpb25hbCBhY3Rpb25zIGJ5IGRpc2FibGluZyBwbGFjaW5nIGFuZCBkZXN0cm95aW5nIGZvciA1MCBtcwoKICAgICAgICAgICAgbG9hZE1hcChtYXApOwogICAgICAgICAgfQogICAgICAgIH0KCiAgICAgICAgaWYobW91c2UuY291bnQpIG1vdXNlLmNvdW50LS07CgogICAgICAgIHJlbmRlcigpOwogICAgICB9CgogICAgICB2YXIgY2JyOwoKICAgICAgLyogZXZlbnQgbGlzdGVuZXJzICovCiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCBlID0+IGtleVtlLmtleUNvZGVdID0gdHJ1ZSk7CiAgICAgIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleXVwJywgIGUgPT4ga2V5W2Uua2V5Q29kZV0gPSBmYWxzZSk7CiAgICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZXVwJywgZSA9PiB7CiAgICAgICAgaWYoIWUuYnV0dG9uKSBtb3VzZS5sZWZ0ID0gZmFsc2U7CiAgICAgICAgZWxzZSBtb3VzZS5yaWdodCA9IGZhbHNlOwogICAgICAgIHJldHVybiBmYWxzZTsKICAgICAgfSk7CiAgICAgIGNhbnZhcy5hZGRFdmVudExpc3RlbmVyKCdtb3VzZWRvd24nLCBlID0+IHsKICAgICAgICBpZihtb3VzZS54IDwgY2JyLmxlZnQgfHwgbW91c2UueCA+IGNici5yaWdodCB8fCBtb3VzZS55IDwgY2JyLnRvcCB8fCBtb3VzZS55ID4gY2JyLmJvdHRvbSkgcmV0dXJuOwogICAgICAgIGlmKCFlLmJ1dHRvbikgbW91c2UubGVmdCA9IHRydWU7CiAgICAgICAgZWxzZSBtb3VzZS5yaWdodCA9IHRydWU7CiAgICAgIH0pOwogICAgICBjYW52YXMuYWRkRXZlbnRMaXN0ZW5lcignbW91c2Vtb3ZlJywgZSA9PiB7CgogICAgICAgIGNiciA9IGNhbnZhcy5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsgLy8gZm9yIG1vdXNlIGxvY2F0aW9uCiAgICAgICAgbW91c2UueCA9IGUucGFnZVggLSBjYnIubGVmdDsKICAgICAgICBtb3VzZS55ID0gZS5wYWdlWSAtIGNici50b3A7CiAgICAgIH0pOwogICAgICBjYW52YXMub25jb250ZXh0bWVudSA9IGUgPT4gZmFsc2U7IC8vIGNhdXNlIHJpZ2h0IGNsaWNrIGlzIHVzZWQgZm9yIGRlc3Ryb3lpbmcgYmxvY2tzCgoKICAgICAgLyoKCiAgICAgIEVYUE9SVFM6CgogICAgICAtIHVwZGF0ZTNEQigpLCB1c2UgaXQgaW4gc2V0SW50ZXJ2YWwKICAgICAgLSBjYW1lcmEuc2V0Rm92KGFuZ2xlKQogICAgICAtIGNhbWVyYS5kaXN0ID0gZGlzdGFuY2UgZnJvbSBtb2RlbAogICAgICAtIGNhbWVyYS50b3AgPSB5LXBvc2l0aW9uIG9mIHRoZSBsb3dlc3QgbGF5ZXIgb2YgbWFwCiAgICAgIC0gbG9hZE1hcChVaW50MzJBcnJheSkgPSBsb2FkIGEgbWFwIGludG8gdGhlIGVkaXRvcgogICAgICAtIHRpbGVfY29sb3IzZCAtIGEgbnVtYmVyIHJlcHJlc2VudGluZyBjdXJyZW50IGZpbGwgY29sb3IKICAgICAgLSBnZXRDb2xvcihodG1sIGNvbG9yIGNvZGUpIC0gcmV0dXJucyBhIG51bWJlciBwcmVzZW50aW5nIGdpdmVuIGNvbG9yCgogICAgICBJTVBPUlRBTlQ6CgogICAgICAtIHdoZW4gcHJvZ3JhbSBsb2FkcywgaXQgZmluZHMgYSBjYW52YXMgZWxlbWVudCB3aXRoIGlkID0gInZveGVsc2NyZWVuIiwKICAgICAgICBtYWtlIHN1cmUgdG8gaGF2ZSB0aGF0IGVsZW1lbnQgc29tZXdoZXJlIGJlZm9yZSBydW5uaW5nIHByb2dyYW0KCiAgICAgICovCgogICAgPC9zY3JpcHQ+CiAgICA8c2NyaXB0IG5hbWU9ImFwcCI+CiAgICAgIHNldEludGVydmFsKHVwZGF0ZTNEQiwgMTApOwogICAgICBsb2FkTWFwKG1hcCk7CiAgICAgIAogICAgICB2YXIgY29uZiA9IHt9OwogICAgICAKICAgICAgcGFyZW50LiRkYi5nZXRSYXcoJ2V0Yy8zREJ1aWxkZXIvY29uZmlnJywgZnVuY3Rpb24oaWRrLCBkYXRhKSB7CiAgICAgICAgaWYodHlwZW9mIGRhdGEgPT0gInN0cmluZyIpIHsKICAgICAgICAgIGNvbmYgPSBKU09OLnBhcnNlKGRhdGEpOwogICAgICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vdXNlJykudmFsdWUgPSBNT1VTRV9TRU5TSVRJVklUWSA9IGNvbmYubW91c2U7CiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIGNvbmYgPSB7bW91c2U6IDEwfTsKICAgICAgICB9CiAgICAgIH0pOwogICAgICAKICAgICAgZnVuY3Rpb24gdXBkYXRlX2NvbmZpZygpIHsKICAgICAgICBwYXJlbnQuJGRiLnNldCgnZXRjLzNEQnVpbGRlci9jb25maWcnLCBKU09OLnN0cmluZ2lmeShjb25mKSk7CiAgICAgIH0KICAgICAgCiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdkaXN0Jykub25pbnB1dCA9IGZ1bmN0aW9uKGUpIHsKCiAgICAgICAgY2FtZXJhLmRpc3QgPSBOdW1iZXIoZS50YXJnZXQudmFsdWUpOwogICAgICB9CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd5cG9zJykub25pbnB1dCA9IGZ1bmN0aW9uKGUpIHsKCiAgICAgICAgY2FtZXJhLnRvcCA9IE51bWJlcihlLnRhcmdldC52YWx1ZSk7CiAgICAgIH0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ21vdXNlJykub25pbnB1dCA9IGZ1bmN0aW9uKGUpIHsKCiAgICAgICAgY29uZi5tb3VzZSA9IE1PVVNFX1NFTlNJVElWSVRZID0gTnVtYmVyKGUudGFyZ2V0LnZhbHVlKTsgdXBkYXRlX2NvbmZpZygpOwogICAgICB9CgogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2F2ZScpLm9uY2xpY2sgPSBmdW5jdGlvbigpIHsKICAgICAgCXBhcmVudC4kcHJvbXB0KCJFbnRlciBkZXNpcmVkIGZpbGVuYW1lLCB0aGVuIHNlbGVjdCBmb2xkZXIgd2hlcmUgeW91IHdhbnQgaXQgc2F2ZWQuIiwgZnVuY3Rpb24oYSwgZm5hbWUpIHsKICAgICAgCSAgaWYoIWEpIHJldHVybjsKICAgICAgICAgIHBhcmVudC4kZXhwbG9yZXIoJ2EvZXRjLzNEQnVpbGRlci9tb2RlbHMvJywge2Jyb3dzZTogdHJ1ZSwgZXhwbG9yZXI6IHRydWUsIG9uY2xvc2U6IGZ1bmN0aW9uKG9rLCBmaWxlKSB7CiAgICAgICAgICAgIGlmIChvaykgewogICAgICAgICAgICAgIHZhciByZCA9ICcnOwogICAgICAgICAgICAgIGZvcih2YXIgaSA9IDA7IGkgPCA0MDk2OyBpKyspIHJkICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoKG1hcFtpXSA+PiAyNCkgJiAyNTUpICsgIFN0cmluZy5mcm9tQ2hhckNvZGUoKG1hcFtpXSA+PiAxNikgJiAyNTUpICsgIFN0cmluZy5mcm9tQ2hhckNvZGUoKG1hcFtpXSA+PiA4KSAmIDI1NSkgKyAgU3RyaW5nLmZyb21DaGFyQ29kZSgobWFwW2ldKSAmIDI1NSk7CiAgICAgICAgICAgICAgcGFyZW50LiRkYi5zZXQoKGZpbGUgKyBmbmFtZSkuc3BsaXQoJy8nKS5zbGljZSgxKS5maWx0ZXIoeCA9PiB4IT0nJykuam9pbignLycpLCByZCk7CiAgICAgICAgICAgICAgc2V0VGltZW91dChwYXJlbnQuJGV4cGxvcmVyLnJlZnJlc2gsIDUwMCk7CiAgICAgICAgICAgIH0KICAgICAgICAgIH19KTsKICAgICAgICB9KTsKICAgICAgfQogICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnb3BlbicpLm9uY2xpY2sgPSBmdW5jdGlvbigpIHsKICAgICAgCXBhcmVudC4kZXhwbG9yZXIoJ2EvZXRjLzNEQnVpbGRlci9tb2RlbHMvJywge2Jyb3dzZTogdHJ1ZSwgZXhwbG9yZXI6IHRydWUsIG9uY2xvc2U6IGZ1bmN0aW9uKG9rLCBmaWxlKSB7CgkJICBpZiAob2spIHsKICAgIAkJcGFyZW50LiRkYi5nZXRSYXcoZmlsZS5zbGljZSgzKSwgYXN5bmMgZnVuY3Rpb24oYSwgcmQpIHsKICAgICAgCQkJZm9yKHZhciBpID0gMDsgaSA8IDQwOTY7IGkrKykgewogICAgICAgICAgICAgICAgICAgbWFwW2ldID0gKHJkLmNoYXJBdChpICogNCkgPDwgMjQpIHwgKHJkLmNoYXJDb2RlQXQoaSAqIDQgKyAxKSA8PCAxNikgIHwgKHJkLmNoYXJDb2RlQXQoaSAqIDQgKyAyKSA8PCA4KSAgfCByZC5jaGFyQ29kZUF0KGkgKiA0ICsgMyk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICBsb2FkTWFwKG1hcCk7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgCiAgICAgIAkJfSk7CiAgCQkgIH0KCQl9fSk7CiAgICAgIH0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BsYWluJykub25jbGljayA9IGZ1bmN0aW9uKCkgewogICAgICAKICAgICAgCSAgZm9yKHZhciBpID0gMDsgaSA8IDMyNzY4OyBpKyspIG1hcFtpXSA9IEVNUFRZOwoJICAgICAgZm9yKHZhciBpID0gMDsgaSA8IDE2OyBpKyspIGZvcih2YXIgaiA9IDA7IGogPCAxNjsgaisrKSBtYXBbZ2V0UG9zKGksIDAsIGopXSA9IDI1NSA8PCA4OwogICAgICAgICAgbG9hZE1hcChtYXApOwogICAgICB9CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCd2b2lkJykub25jbGljayA9IGZ1bmN0aW9uKCkgewogICAgICAKICAgICAgCSAgZm9yKHZhciBpID0gMDsgaSA8IDMyNzY4OyBpKyspIG1hcFtpXSA9IEVNUFRZOwoJICAgICAgZm9yKHZhciBpID0gODsgaSA8IDEwOyBpKyspIGZvcih2YXIgaiA9IDg7IGogPCAxMDsgaisrKSBtYXBbZ2V0UG9zKGksIDAsIGopXSA9IDI1NSA8PCA4OwogICAgICAgICAgbG9hZE1hcChtYXApOwogICAgICB9CiAgICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjb2xvcicpLm9uY2xpY2sgPSBmdW5jdGlvbigpIHsKICAgICAgCiAgICAgIAkgIHBhcmVudC4kcHJvbXB0KCJFbnRlciBjb2xvciBjb2RlIGJlbG93LCBpZiB5b3UgZG9uJ3Qga25vdyB3aGF0IHlvdSdyZSBkb2luZyBjbGljayBjYW5jZWwiLCBmdW5jdGlvbihvaywgdGV4dCkgewogICAgICAgICAgICBpZihvaykgdHJ5IHsgdGlsZV9jb2xvcjNkID0gZ2V0Q29sb3IodGV4dCk7IH0gY2F0Y2goZXIpIHsgcGFyZW50LiRhbGVydC5lcnJvcigiWW91IGRpZG4ndCBrbm93IHdoYXQgeW91IHdlcmUgZG9pbmchIikgfQogICAgICAgICAgfSk7CiAgICAgIH0KICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2hlbHAnKS5vbmNsaWNrID0gXz0+cGFyZW50LiRhbGVydCgnPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3dpbmRvd3M5My1jb21tdW5pdHkvQnVpbGQzRC9ibG9iL21hc3Rlci9oZWxwLm1kIj4gSGVscCBwYWdlIG9uIGdpdGh1YiA8L2E+Jyk7CiAgICA8L3NjcmlwdD4KICA8L2JvZHk+CjwvaHRtbD4K";
var application_init = "bGUuX2FwcHNbIkJ1aWxkM0QiXSA9IHsKICBuYW1lOiAiM0RCdWlsZGVyIiwKICBjYXRoZWdvcmllczogIkdyYXBoaWNzIiwKICBpY29uOiAiL2MvZmlsZXMvaW1hZ2VzL2ljb25zL2JvbWIucG5nIiwKICBleGVjOiAoKT0+ICRleGUoImlmcmFtZSAvYS9ldGMvM0RCdWlsZGVyL2FwcC5odG1sIC0td2lkdGg9NDg0IC0tLWhlaWdodD02NDAgLS1pY29uPS9jL2ZpbGVzL2ltYWdlcy9pY29ucy9ib21iLnBuZyIpCn0=";

/* create files and folders */

$db.set("etc/3DBuilder/models/README.txt", "You can save your models here.");
$db.set("etc/3DBuilder/app.html", atob(application_base64));
$db.set("boot/Build3D_init.js", atob(application_init));
localStorage.setItem('desktop/Build3D.lnk42', '{"exe":"Build3D"}');

$alert("Press OK to restart.", function() {$exe("reboot")})
